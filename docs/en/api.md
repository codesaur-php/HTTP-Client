# üìö API Documentation

Complete API documentation for the **codesaur/http-client** package.

> **Note:** This API documentation was generated by Cursor AI.

---

## üì¶ Namespace

```
codesaur\Http\Client
```

---

## üîß Classes

### 1. CurlClient

Lightweight cURL client for sending HTTP requests.

#### Description

This class sends HTTP requests to any desired URL using any HTTP method (`GET`, `POST`, `PUT`, `DELETE`, etc.) and returns the server's response as text.

#### Methods

##### `request()`

Main function to send HTTP request to the given URL.

**Signature:**
```php
public function request(
    string $uri, 
    string $method = 'GET', 
    string $data = '', 
    array $options = []
): string
```

**Parameters:**
- `$uri` (string) - URL or endpoint to send the request to
- `$method` (string) - HTTP method to use (default - `GET`)
- `$data` (string) - Data to send with the request. If not empty, it will be automatically added to the `CURLOPT_POSTFIELDS` configuration
- `$options` (array<int|string, mixed>) - Additional cURL configuration options. For example:
  - `CURLOPT_TIMEOUT => 10`
  - `CURLOPT_HTTPHEADER => ['Content-Type: application/json']`

**Returns:**
- `string` - Server response (response body) on successful execution

**Throws:**
- `\Exception` - Throws `Exception` if an error occurs during cURL execution. The error code is from `curl_errno()`, and the error text is from `curl_error()`

**Example:**
```php
use codesaur\Http\Client\CurlClient;

$curl = new CurlClient();

// GET request
$response = $curl->request('https://httpbin.org/get', 'GET');
echo $response;

// POST request
$response = $curl->request(
    'https://httpbin.org/post',
    'POST',
    'key=value',
    [
        CURLOPT_HTTPHEADER => ['Content-Type: application/x-www-form-urlencoded'],
        CURLOPT_TIMEOUT => 30
    ]
);
```

---

### 2. JSONClient

Client for sending JSON-based HTTP requests.

#### Description

This class works on top of CurlClient and easily sends GET, POST, PUT, DELETE requests with JSON payloads, returning the server's response as a PHP array.

In case of errors, instead of throwing an Exception, it returns:
```json
{
  "error": {
    "code": 123,
    "message": "An error occurred..."
  }
}
```
formatted array.

#### Methods

##### `get()`

Send JSON GET request.

**Signature:**
```php
public function get(string $uri, array $payload = [], array $headers = []): array
```

**Parameters:**
- `$uri` (string) - URL to access
- `$payload` (array) - Data to be added as query string
- `$headers` (array) - Additional HTTP headers (in `name => value` format)

**Returns:**
- `array` - Decoded JSON response or error structure

**Example:**
```php
use codesaur\Http\Client\JSONClient;

$client = new JSONClient();

$response = $client->get(
    'https://httpbin.org/get',
    ['hello' => 'world'],
    ['Authorization' => 'Bearer token123']
);

print_r($response);
```

##### `post()`

Send JSON POST request.

**Signature:**
```php
public function post(string $uri, array $payload, array $headers = []): array
```

**Parameters:**
- `$uri` (string) - URL to access
- `$payload` (array) - Data to send as JSON
- `$headers` (array) - Additional HTTP headers

**Returns:**
- `array` - Server's JSON response

**Example:**
```php
$response = $client->post(
    'https://httpbin.org/post',
    ['test' => 'codesaur'],
    ['X-Custom-Header' => 'value']
);

echo $response['json']['test']; // codesaur
```

##### `put()`

Send JSON PUT request.

**Signature:**
```php
public function put(string $uri, array $payload, array $headers = []): array
```

**Parameters:**
- `$uri` (string) - URL to access
- `$payload` (array) - Data to send as JSON
- `$headers` (array) - Additional HTTP headers

**Returns:**
- `array` - Server's JSON response

**Example:**
```php
$response = $client->put(
    'https://httpbin.org/put',
    ['id' => 1, 'name' => 'Updated Name']
);
```

##### `delete()`

Send JSON DELETE request.

**Signature:**
```php
public function delete(string $uri, array $payload = [], array $headers = []): array
```

**Parameters:**
- `$uri` (string) - URL to access
- `$payload` (array) - Data to send as JSON
- `$headers` (array) - Additional HTTP headers

**Returns:**
- `array` - Server's JSON response

**Example:**
```php
$response = $client->delete(
    'https://httpbin.org/delete',
    ['id' => 123]
);
```

##### `request()`

Main function to send JSON HTTP request.

**Signature:**
```php
public function request(string $uri, string $method, array $payload, array $headers): array
```

**Parameters:**
- `$uri` (string) - URL to send the request to
- `$method` (string) - HTTP method (GET, POST, PUT, DELETE)
- `$payload` (array) - Data to send
- `$headers` (array) - Additional headers (`key => value`)

**Returns:**
- `array` - JSON decoded response array, or:
  ```php
  ['error' => ['code' => ..., 'message' => ...]]
  ```

**Features:**
- ‚úî Automatically converts payload to JSON
- ‚úî Automatically adds Content-Type: application/json header
- ‚úî SSL verification depends on `CODESAUR_APP_ENV` environment variable:
  - SSL verification disabled in `development` environment
  - SSL verification enabled in `production` or other environments (secure)
- ‚úî Checks for JSON decode errors
- ‚úî Returns all errors in a unified 'error' structure

**Environment Configuration:**
```bash
# .env file or environment variable
CODESAUR_APP_ENV=development  # or production
```

---

### 3. Mail

Lightweight email client class for sending MIME standard emails with attachments or simple emails using PHP's `mail()` function.

#### Description

**Features:**
- Manage To / Cc / Bcc recipients
- Support for inline and various types of attachments:
  - file path ‚Üí `addFileAttachment()`
  - URL ‚Üí `addUrlAttachment()`
  - raw content ‚Üí `addContentAttachment()`
- Send HTML and plaintext emails
- Full UTF-8 encoded header & filename support
- Automatically generates MIME multipart emails

#### Properties

- `$_recipients` (private array) - List of recipients (To, Cc, Bcc)
- `$from` (protected string) - Sender's email address
- `$fromName` (protected string) - Sender's name
- `$replyTo` (protected string) - Reply-to email
- `$replyToName` (protected string) - Reply-to name
- `$subject` (protected string) - Email subject
- `$message` (protected string) - Email message main content
- `$_attachments` (private array) - List of attachments

#### Methods

##### `targetTo()`

Reset all recipients and assign only one new recipient.

**Signature:**
```php
public function targetTo(string $email, string $name = ''): self
```

**Parameters:**
- `$email` (string) - Recipient's email address
- `$name` (string) - Recipient's name (optional)

**Returns:**
- `self` - Returns the object for fluent interface

**Example:**
```php
use codesaur\Http\Client\Mail;

$mail = new Mail();
$mail->targetTo('user@example.com', 'User');
```

##### `addRecipient()`

Add To recipient.

**Signature:**
```php
public function addRecipient(string $email, string $name = ''): self
```

**Parameters:**
- `$email` (string) - Recipient's email address
- `$name` (string) - Recipient's name (optional)

**Returns:**
- `self` - Returns the object for fluent interface

**Example:**
```php
$mail->addRecipient('user1@example.com', 'Person 1');
$mail->addRecipient('user2@example.com', 'Person 2');
```

##### `addCCRecipient()`

Add Cc recipient.

**Signature:**
```php
public function addCCRecipient(string $email, string $name = ''): self
```

**Parameters:**
- `$email` (string) - Cc recipient's email address
- `$name` (string) - Cc recipient's name (optional)

**Returns:**
- `self` - Returns the object for fluent interface

**Example:**
```php
$mail->addCCRecipient('cc@example.com', 'CC Recipient');
```

##### `addBCCRecipient()`

Add Bcc recipient.

**Signature:**
```php
public function addBCCRecipient(string $email, string $name = ''): self
```

**Parameters:**
- `$email` (string) - Bcc recipient's email address
- `$name` (string) - Bcc recipient's name (optional)

**Returns:**
- `self` - Returns the object for fluent interface

**Example:**
```php
$mail->addBCCRecipient('bcc@example.com', 'BCC Recipient');
```

##### `addRecipients()`

Add multiple recipients as an array.

**Signature:**
```php
public function addRecipients(array $recipients): self
```

**Parameters:**
- `$recipients` (array) - Array of recipients: `['To'=>[], 'Cc'=>[], 'Bcc'=>[]]`
  - Example: `['To' => [['email' => 'user@example.com', 'name' => 'Name']]]`

**Returns:**
- `self` - Returns the object for fluent interface

**Example:**
```php
$mail->addRecipients([
    'To' => [
        ['email' => 'user1@example.com', 'name' => 'Name 1'],
        ['email' => 'user2@example.com', 'name' => 'Name 2']
    ],
    'Cc' => [
        ['email' => 'cc@example.com', 'name' => 'CC']
    ],
    'Bcc' => [
        ['email' => 'bcc@example.com']
    ]
]);
```

##### `getRecipients()`

Return list of recipients of a specific type.

**Signature:**
```php
public function getRecipients(string $type): array
```

**Parameters:**
- `$type` (string) - Recipient type ('To', 'Cc', 'Bcc')

**Returns:**
- `array` - List of recipients, or empty array

**Example:**
```php
$toRecipients = $mail->getRecipients('To');
// [
//     ['email' => 'user1@example.com', 'name' => 'Name 1'],
//     ['email' => 'user2@example.com']
// ]
```

##### `setSubject()`

Set email subject.

**Signature:**
```php
public function setSubject(string $subject): self
```

**Parameters:**
- `$subject` (string) - Email subject

**Returns:**
- `self` - Returns the object for fluent interface

**Example:**
```php
$mail->setSubject('Hello!');
```

##### `setMessage()`

Set email main content.

**Signature:**
```php
public function setMessage(string $message): self
```

**Parameters:**
- `$message` (string) - Email content (HTML or plain text)

**Returns:**
- `self` - Returns the object for fluent interface

**Example:**
```php
$mail->setMessage('<h1>Hello!</h1><p>Test email.</p>');
```

##### `setFrom()`

Set sender information.

**Signature:**
```php
public function setFrom(string $email, string $name = ''): self
```

**Parameters:**
- `$email` (string) - Sender's email address
- `$name` (string) - Sender's name (optional)

**Returns:**
- `self` - Returns the object for fluent interface

**Throws:**
- `\InvalidArgumentException` - If email address is invalid

**Example:**
```php
$mail->setFrom('no-reply@example.com', 'codesaur');
```

##### `setReplyTo()`

Set Reply-To.

**Signature:**
```php
public function setReplyTo(string $email, string $name = ''): self
```

**Parameters:**
- `$email` (string) - Reply-to email address
- `$name` (string) - Reply-to name (optional)

**Returns:**
- `self` - Returns the object for fluent interface

**Throws:**
- `\InvalidArgumentException` - If email address is invalid

**Example:**
```php
$mail->setReplyTo('support@example.com', 'Support Team');
```

##### `addAttachment()`

Add attachment and route based on the given type.

**Signature:**
```php
public function addAttachment(array $attachment): self
```

**Parameters:**
- `$attachment` (array) - Attachment array:
  - `['path' => '/path/to/file']` - by file path
  - `['url' => 'https://example.com/file']` - by URL
  - `['content' => '...', 'name' => 'file.txt']` - by content

**Returns:**
- `self` - Returns the object for fluent interface

**Throws:**
- `\InvalidArgumentException` - If attachment information is invalid

**Example:**
```php
$mail->addAttachment(['path' => '/path/to/file.pdf']);
$mail->addAttachment(['url' => 'https://example.com/logo.png']);
$mail->addAttachment(['content' => 'Hello world', 'name' => 'note.txt']);
```

##### `addFileAttachment()`

Add attachment by file path.

**Signature:**
```php
public function addFileAttachment(string $filePath): self
```

**Parameters:**
- `$filePath` (string) - File path to attach

**Returns:**
- `self` - Returns the object for fluent interface

**Throws:**
- `\InvalidArgumentException` - If file is not found or invalid

**Example:**
```php
$mail->addFileAttachment(__DIR__ . '/file.pdf');
```

##### `addUrlAttachment()`

Add file from URL as attachment.

**Signature:**
```php
public function addUrlAttachment(string $fileUrl): self
```

**Parameters:**
- `$fileUrl` (string) - File URL to attach

**Returns:**
- `self` - Returns the object for fluent interface

**Throws:**
- `\InvalidArgumentException` - If URL is invalid or file is not found

**Example:**
```php
$mail->addUrlAttachment('https://example.com/logo.png');
```

##### `addContentAttachment()`

Add attachment with raw binary data.

**Signature:**
```php
public function addContentAttachment(string $fileContent, string $fileName): self
```

**Parameters:**
- `$fileContent` (string) - Attachment content (binary or text)
- `$fileName` (string) - Attachment file name

**Returns:**
- `self` - Returns the object for fluent interface

**Throws:**
- `\InvalidArgumentException` - If content or file name is empty

**Example:**
```php
$mail->addContentAttachment("Hello world", "note.txt");
```

##### `clearAttachments()`

Clear attachments.

**Signature:**
```php
public function clearAttachments(): void
```

**Example:**
```php
$mail->clearAttachments();
```

##### `getAttachments()`

Return list of attachments.

**Signature:**
```php
public function getAttachments(): array
```

**Returns:**
- `array` - List of attachments, or empty array

**Example:**
```php
$attachments = $mail->getAttachments();
```

##### `sendMail()`

Main function to send email.

**Signature:**
```php
public function sendMail(): bool
```

**Returns:**
- `bool` - Whether email was sent successfully

**Throws:**
- `\InvalidArgumentException` - If recipient, sender, subject, or message is not set
- `\RuntimeException` - If an error occurs during sending

**Description:**
Generates MIME multipart email and sends it with or without attachments.

**Example:**
```php
$mail = new Mail();

$mail->targetTo('user@example.com', 'User');
$mail->setFrom('no-reply@example.com', 'codesaur');
$mail->setSubject('Hello!');
$mail->setMessage('<h1>Hello!</h1><p>Test email.</p>');
$mail->addFileAttachment(__DIR__ . '/file.pdf');

$mail->sendMail();
```

---

## üîÑ Fluent Interface

The Mail class supports fluent interface, as many methods return `$this`:

```php
$mail = new Mail();

$mail
    ->targetTo('user@example.com', 'User')
    ->setFrom('no-reply@example.com', 'codesaur')
    ->setSubject('Hello!')
    ->setMessage('<h1>Hello!</h1><p>Test email.</p>')
    ->addFileAttachment(__DIR__ . '/file.pdf')
    ->addRecipient('cc@example.com', 'CC')
    ->sendMail();
```

---

## ‚ö†Ô∏è Exceptions

### CurlClient

- `\Exception` - If an error occurs during cURL execution

### JSONClient

In case of errors, instead of throwing an Exception, it returns an error structure:
```php
['error' => ['code' => ..., 'message' => ...]]
```

### Mail

- `\InvalidArgumentException` - If email address is invalid, file is not found, or required value is not set
- `\RuntimeException` - If an error occurs during email sending

---

## üìù Notes

1. **SSL Verification:** JSONClient configures SSL verification based on the `CODESAUR_APP_ENV` environment variable:
   - `development` ‚Üí SSL verification disabled
   - `production` or others ‚Üí SSL verification enabled (default)

2. **UTF-8 Support:** Mail class has full UTF-8 support (names, file names, headers, etc.)

3. **MIME Multipart:** Mail class automatically generates MIME multipart emails when attachments are present

4. **Error Handling:** JSONClient returns all errors in a unified 'error' structure, does not throw Exceptions

---

## üìÑ License

MIT License

---

**API Documentation Generated by:** Cursor AI  
**Last Updated:** 2025
